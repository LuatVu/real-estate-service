<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-latest.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">
    <changeSet author="VLC1HC (generated)" id="1753846306969-1">
        <createTable tableName="districts">
            <column name="code" type="VARCHAR(20)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="name_en" type="VARCHAR(255)"/>
            <column name="full_name" type="VARCHAR(255)"/>
            <column name="full_name_en" type="VARCHAR(255)"/>
            <column name="code_name" type="VARCHAR(255)"/>
            <column name="province_code" type="VARCHAR(20)"/>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-2">
        <createTable tableName="images">
            <column defaultValue="uuid()" name="image_id" type="VARCHAR(255)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="post_id" type="VARCHAR(50)"/>
            <column name="file_path" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="file_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="NULL" name="file_size" type="INT"/>
            <column name="mime_type" type="VARCHAR(100)"/>
            <column defaultValueComputed="0" name="is_primary" type="TINYINT(1)"/>
            <column defaultValueComputed="current_timestamp()" name="upload_date" type="timestamp"/>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-3">
        <createTable tableName="packages">
            <column defaultValue="uuid()" name="package_id" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="package_name" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="price" type="DECIMAL(15, 2)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="max_diamond_posts" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="max_gold_posts" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="max_silver_posts" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="max_normal_posts" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="current_timestamp()" name="created_date" type="timestamp"/>
            <column defaultValueComputed="current_timestamp() on update current_timestamp()" name="updated_date" type="timestamp"/>
            <column defaultValueNumeric="1" name="status" type="INT"/>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-4">
        <createTable tableName="permissions">
            <column defaultValue="uuid()" name="permission_id" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="permission_name" type="VARCHAR(50)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-5">
        <createTable tableName="posts">
            <column defaultValue="uuid()" name="post_id" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_id" type="VARCHAR(50)"/>
            <column name="title" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="TEXT"/>
            <column defaultValueComputed="NULL" name="acreage" type="DECIMAL(15, 2)"/>
            <column defaultValueComputed="NULL" name="bedrooms" type="INT"/>
            <column defaultValueComputed="NULL" name="bathrooms" type="INT"/>
            <column defaultValue="CO_BAN" name="furniture" type="ENUM('DAY_DU', 'CO_BAN', 'KHONG_NOI_THAT')"/>
            <column defaultValue="SO_DO" name="legal" type="ENUM('SO_DO', 'HOP_DONG_MUA_BAN', 'KHONG_SO')"/>
            <column defaultValueComputed="NULL" name="price" type="DECIMAL(15, 2)"/>
            <column name="province_code" type="VARCHAR(20)"/>
            <column name="district_code" type="VARCHAR(20)"/>
            <column name="ward_code" type="VARCHAR(20)"/>
            <column name="address" type="TEXT"/>
            <column defaultValueComputed="current_timestamp()" name="created_date" type="timestamp"/>
            <column defaultValueComputed="current_timestamp() on update current_timestamp()" name="updated_date" type="timestamp"/>
            <column name="expired_at" type="timestamp">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="DRAFT" name="status" type="ENUM('DRAFT', 'PUBLISHED', 'EXPIRED', 'DELETED')"/>
            <column defaultValueComputed="NULL" name="floors" type="INT"/>
            <column defaultValue="DONG" name="direction" type="ENUM('DONG', 'TAY', 'NAM', 'BAC', 'DONG_BAC', 'TAY_BAC', 'DONG_NAM', 'TAY_NAM')"/>
            <column defaultValue="CHCC" name="type" type="ENUM('CHCC', 'NHA_RIENG', 'BIET_THU', 'NHA_PHO', 'DAT_NEN', 'CONDOTEL', 'KHO_NHA_XUONG', 'BDS_KHAC')"/>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-6">
        <createTable tableName="provinces">
            <column defaultValue="uuid()" name="code" type="VARCHAR(20)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="name_en" type="VARCHAR(255)"/>
            <column name="full_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="full_name_en" type="VARCHAR(255)"/>
            <column name="code_name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-7">
        <createTable tableName="ranking">
            <column name="ranking_id" type="VARCHAR(255)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="post_id" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="NORMAL" name="priority_level" type="ENUM('DIAMOND', 'GOLD', 'SILVER', 'NORMAL')">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="current_timestamp()" name="bump_time" type="timestamp"/>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-8">
        <createTable tableName="role_permissions">
            <column defaultValue="uuid()" name="role_id" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="uuid()" name="permission_id" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-9">
        <createTable tableName="roles">
            <column defaultValue="uuid()" name="role_id" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="role_name" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-10">
        <createTable tableName="social_auth">
            <column defaultValue="uuid()" name="auth_id" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_id" type="VARCHAR(50)"/>
            <column name="provider" type="ENUM('GMAIL', 'FACEBOOK')">
                <constraints nullable="false"/>
            </column>
            <column name="provider_user_id" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-11">
        <createTable tableName="transactions">
            <column defaultValue="uuid()" name="transaction_id" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_id" type="VARCHAR(50)"/>
            <column name="amount" type="DECIMAL(15, 2)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="DEPOSIT" name="transaction_type" type="ENUM('DEPOSIT', 'WITHDRAWAL', 'POST_PAYMENT')">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="PENDING" name="status" type="ENUM('PENDING', 'COMPLETED', 'FAILED')"/>
            <column defaultValueComputed="current_timestamp()" name="created_at" type="timestamp"/>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-12">
        <createTable tableName="user_balances">
            <column name="balance_id" type="VARCHAR(255)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="uuid()" name="user_id" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0.00" name="main_balance" type="DECIMAL(15, 2)"/>
            <column defaultValueComputed="NULL" name="main_balance_expired_date" type="timestamp"/>
            <column defaultValueNumeric="0.00" name="promo_balance" type="DECIMAL(15, 2)"/>
            <column defaultValueComputed="NULL" name="promo_balance_expired_date" type="timestamp"/>
            <column defaultValueComputed="current_timestamp()" name="created_date" type="timestamp"/>
            <column defaultValueComputed="current_timestamp() on update current_timestamp()" name="updated_date" type="timestamp"/>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-13">
        <createTable tableName="user_packages">
            <column defaultValue="uuid()" name="user_package_id" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="uuid()" name="user_id" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="uuid()" name="package_id" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="remaining_diamond_posts" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="remaining_gold_posts" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="remaining_silver_posts" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="remaining_normal_posts" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="current_timestamp()" name="active_date" type="timestamp"/>
            <column defaultValueComputed="current_timestamp()" name="expired_date" type="timestamp"/>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-14">
        <createTable tableName="user_roles">
            <column defaultValue="uuid()" name="user_id" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="uuid()" name="role_id" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-15">
        <createTable tableName="users">
            <column defaultValue="uuid()" name="user_id" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="username" type="VARCHAR(50)"/>
            <column name="phone_number" type="VARCHAR(15)">
                <constraints unique="true"/>
            </column>
            <column name="email" type="VARCHAR(100)">
                <constraints unique="true"/>
            </column>
            <column name="password_hash" type="VARCHAR(255)"/>
            <column defaultValueComputed="current_timestamp()" name="created_at" type="timestamp"/>
            <column defaultValueComputed="current_timestamp() on update current_timestamp()" name="updated_at" type="timestamp"/>
            <column defaultValueComputed="1" name="is_active" type="TINYINT(1)"/>
            <column defaultValueComputed="NULL" name="last_login" type="timestamp"/>
            <column name="facebook_id" remarks="Facebook id for login by facebook auth" type="VARCHAR(100)">
                <constraints unique="true"/>
            </column>
            <column name="google_id" remarks="Google id for login by facebook auth" type="VARCHAR(100)">
                <constraints unique="true"/>
            </column>
            <column defaultValue="Credentials" name="auth_provider" remarks="define authen provider" type="ENUM('Credentials', 'Facebook', 'Google')"/>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-16">
        <createTable tableName="wards">
            <column name="code" type="VARCHAR(20)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="name_en" type="VARCHAR(255)"/>
            <column name="full_name" type="VARCHAR(255)"/>
            <column name="full_name_en" type="VARCHAR(255)"/>
            <column name="code_name" type="VARCHAR(255)"/>
            <column name="district_code" type="VARCHAR(20)"/>
        </createTable>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-17">
        <addUniqueConstraint columnNames="provider, provider_user_id" constraintName="unique_provider_user" tableName="social_auth"/>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-18">
        <createIndex associatedWith="" indexName="FKamf4ragc34vb3il9wxrwjxw7b" tableName="user_packages">
            <column name="package_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-19">
        <createIndex associatedWith="" indexName="idx_districts_province" tableName="districts">
            <column name="province_code"/>
        </createIndex>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-20">
        <createIndex associatedWith="" indexName="idx_images_post_id" tableName="images">
            <column name="post_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-21">
        <createIndex associatedWith="" indexName="idx_posts_user_id" tableName="posts">
            <column name="user_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-22">
        <createIndex associatedWith="" indexName="idx_wards_district" tableName="wards">
            <column name="district_code"/>
        </createIndex>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-23">
        <createIndex associatedWith="" indexName="permission_id" tableName="role_permissions">
            <column name="permission_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-24">
        <createIndex associatedWith="" indexName="post_id" tableName="ranking">
            <column name="post_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-25">
        <createIndex associatedWith="" indexName="role_id" tableName="user_roles">
            <column name="role_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-26">
        <createIndex associatedWith="" indexName="user_id" tableName="social_auth">
            <column name="user_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-27">
        <createIndex associatedWith="" indexName="user_id" tableName="transactions">
            <column name="user_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-28">
        <createIndex associatedWith="" indexName="user_id" tableName="user_balances">
            <column name="user_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-29">
        <createIndex associatedWith="" indexName="user_packages_fk1" tableName="user_packages">
            <column name="user_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-30">
        <addForeignKeyConstraint baseColumnNames="package_id" baseTableName="user_packages" constraintName="FKamf4ragc34vb3il9wxrwjxw7b" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="package_id" referencedTableName="packages" validate="true"/>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-31">
        <addForeignKeyConstraint baseColumnNames="province_code" baseTableName="districts" constraintName="districts_province_code_fkey" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="code" referencedTableName="provinces" validate="true"/>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-32">
        <addForeignKeyConstraint baseColumnNames="post_id" baseTableName="images" constraintName="images_ibfk_1" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="post_id" referencedTableName="posts" validate="true"/>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-33">
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="posts" constraintName="posts_ibfk_1" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="user_id" referencedTableName="users" validate="true"/>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-34">
        <addForeignKeyConstraint baseColumnNames="post_id" baseTableName="ranking" constraintName="ranking_ibfk_1" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="RESTRICT" referencedColumnNames="post_id" referencedTableName="posts" validate="true"/>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-35">
        <addForeignKeyConstraint baseColumnNames="role_id" baseTableName="role_permissions" constraintName="role_permissions_ibfk_1" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="role_id" referencedTableName="roles" validate="true"/>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-36">
        <addForeignKeyConstraint baseColumnNames="permission_id" baseTableName="role_permissions" constraintName="role_permissions_ibfk_2" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="permission_id" referencedTableName="permissions" validate="true"/>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-37">
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="social_auth" constraintName="social_auth_ibfk_1" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="user_id" referencedTableName="users" validate="true"/>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-38">
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="transactions" constraintName="transactions_ibfk_1" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="user_id" referencedTableName="users" validate="true"/>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-39">
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="user_balances" constraintName="user_balances_ibfk_1" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="RESTRICT" referencedColumnNames="user_id" referencedTableName="users" validate="true"/>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-40">
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="user_packages" constraintName="user_packages_fk1" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="RESTRICT" referencedColumnNames="user_id" referencedTableName="users" validate="true"/>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-41">
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="user_roles" constraintName="user_roles_ibfk_1" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="user_id" referencedTableName="users" validate="true"/>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-42">
        <addForeignKeyConstraint baseColumnNames="role_id" baseTableName="user_roles" constraintName="user_roles_ibfk_2" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="role_id" referencedTableName="roles" validate="true"/>
    </changeSet>
    <changeSet author="VLC1HC (generated)" id="1753846306969-43">
        <addForeignKeyConstraint baseColumnNames="district_code" baseTableName="wards" constraintName="wards_district_code_fkey" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="code" referencedTableName="districts" validate="true"/>
    </changeSet>
</databaseChangeLog>
